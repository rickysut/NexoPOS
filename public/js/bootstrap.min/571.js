/*! For license information please see 571.js.LICENSE.txt */
"use strict";(self.webpackChunknexopos_4x=self.webpackChunknexopos_4x||[]).push([[571,792],{2792:(t,e,r)=>{r.r(e),r.d(e,{default:()=>g});var i=r(3658),n=r(1487),o=r(2381),s=r(8094),a=r(1419),u=r(2909);function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function l(){l=function(){return e};var t,e={},r=Object.prototype,i=r.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function d(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{d({},"")}catch(t){d=function(t,e,r){return t[e]=r}}function p(t,e,r,i){var o=e&&e.prototype instanceof g?e:g,s=Object.create(o.prototype),a=new V(i||[]);return n(s,"_invoke",{value:j(t,r,a)}),s}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=p;var m="suspendedStart",v="suspendedYield",_="executing",h="completed",b={};function g(){}function y(){}function x(){}var w={};d(w,s,(function(){return this}));var C=Object.getPrototypeOf,k=C&&C(C(U([])));k&&k!==r&&i.call(k,s)&&(w=k);var P=x.prototype=g.prototype=Object.create(w);function O(t){["next","throw","return"].forEach((function(e){d(t,e,(function(t){return this._invoke(e,t)}))}))}function $(t,e){function r(n,o,s,a){var u=f(t[n],t,o);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==c(d)&&i.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,s,a)}),(function(t){r("throw",t,s,a)})):e.resolve(d).then((function(t){l.value=t,s(l)}),(function(t){return r("throw",t,s,a)}))}a(u.arg)}var o;n(this,"_invoke",{value:function(t,i){function n(){return new e((function(e,n){r(t,i,e,n)}))}return o=o?o.then(n,n):n()}})}function j(e,r,i){var n=m;return function(o,s){if(n===_)throw new Error("Generator is already running");if(n===h){if("throw"===o)throw s;return{value:t,done:!0}}for(i.method=o,i.arg=s;;){var a=i.delegate;if(a){var u=F(a,i);if(u){if(u===b)continue;return u}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===m)throw n=h,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=_;var c=f(e,r,i);if("normal"===c.type){if(n=i.done?h:v,c.arg===b)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(n=h,i.method="throw",i.arg=c.arg)}}}function F(e,r){var i=r.method,n=e.iterator[i];if(n===t)return r.delegate=null,"throw"===i&&e.iterator.return&&(r.method="return",r.arg=t,F(e,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+i+"' method")),b;var o=f(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,b;var s=o.arg;return s?s.done?(r[e.resultName]=s.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,b):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function V(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function U(e){if(e||""===e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function r(){for(;++n<e.length;)if(i.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(c(e)+" is not iterable")}return y.prototype=x,n(P,"constructor",{value:x,configurable:!0}),n(x,"constructor",{value:y,configurable:!0}),y.displayName=d(x,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,d(t,u,"GeneratorFunction")),t.prototype=Object.create(P),t},e.awrap=function(t){return{__await:t}},O($.prototype),d($.prototype,a,(function(){return this})),e.AsyncIterator=$,e.async=function(t,r,i,n,o){void 0===o&&(o=Promise);var s=new $(p(t,r,i,n),o);return e.isGeneratorFunction(r)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},O(P),d(P,u,"Generator"),d(P,s,(function(){return this})),d(P,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var i in e)r.push(i);return r.reverse(),function t(){for(;r.length;){var i=r.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=U,V.prototype={constructor:V,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(i,n){return a.type="throw",a.arg=e,r.next=i,n&&(r.method="next",r.arg=t),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var u=i.call(s,"catchLoc"),c=i.call(s,"finallyLoc");if(u&&c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=e,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var n=i.arg;T(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,i){return this.delegate={iterator:U(e),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=t),b}},e}function d(t,e,r,i,n,o,s){try{var a=t[o](s),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(i,n)}const p={name:"ns-product-group",props:["fields"],watch:{searchValue:function(){var t=this;clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout((function(){t.searchProducts(t.searchValue)}),1e3)},products:{deep:!0,handler:function(){this.$forceUpdate()}}},computed:{totalProducts:function(){return this.products.length>0?(this.$emit("update",this.products),this.products.map((function(t){return parseFloat(t.sale_price)*parseFloat(t.quantity)})).reduce((function(t,e){return t+e}))):0}},mounted:function(){var t=this.fields.filter((function(t){return"product_subitems"===t.name}));t.length>0&&void 0!==t[0].value&&t[0].value.length>0&&(this.products=t[0].value)},data:function(){return{searchValue:"",searchTimeout:null,results:[],products:[]}},methods:{__:s.__,setSalePrice:function(){this.$emit("updateSalePrice",this.totalProducts)},removeProduct:function(t){var e=this;a.G.show(o.default,{title:(0,s.__)("Delete Sub item"),message:(0,s.__)("Would you like to delete this sub item?"),onAction:function(r){r&&e.products.splice(t,1)}})},toggleUnitField:function(t){var e=this;t._unit_toggled||(t._unit_toggled=!t._unit_toggled),setTimeout((function(){t._unit_toggled&&e.$refs.unitField[0].addEventListener("blur",(function(){t._unit_toggled=!1,e.$forceUpdate()}))}),200)},toggleQuantityField:function(t){var e=this;t._quantity_toggled=!t._quantity_toggled,setTimeout((function(){t._quantity_toggled&&(e.$refs.quantityField[0].select(),e.$refs.quantityField[0].addEventListener("blur",(function(){e.toggleQuantityField(t),e.$forceUpdate()})))}),200)},togglePriceField:function(t){var e=this;t._price_toggled=!t._price_toggled,setTimeout((function(){t._price_toggled&&(e.$refs.priceField[0].select(),e.$refs.priceField[0].addEventListener("blur",(function(){e.togglePriceField(t),e.$forceUpdate()})))}),200)},redefineUnit:function(t){var e=t.unit_quantities.filter((function(e){return e.id===t.unit_quantity_id}));e.length>0&&(t.unit_quantity=e[0],t.unit_id=e[0].unit.id,t.unit=e[0].unit,t.sale_price=e[0].sale_price)},addResult:function(t){var e,r=this;return(e=l().mark((function e(){var i,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.searchValue="","grouped"!==t.type){e.next=3;break}return e.abrupt("return",n.kX.error((0,s.__)("Unable to add a grouped product.")).subscribe());case 3:return e.prev=3,e.next=6,new Promise((function(e,r){a.G.show(u.Z,{label:(0,s.__)("Choose The Unit"),options:t.unit_quantities.map((function(t){return{label:t.unit.name,value:t.id}})),resolve:e,reject:r})}));case 6:i=e.sent,o=t.unit_quantities.filter((function(t){return parseInt(t.id)===parseInt(i[0].value)})),r.products.push({name:t.name,unit_quantity_id:i[0].value,unit_quantity:o[0],unit_id:o[0].unit.id,unit:o[0].unit,product_id:o[0].product_id,quantity:1,_price_toggled:!1,_quantity_toggled:!1,_unit_toggled:!1,unit_quantities:t.unit_quantities,sale_price:o[0].sale_price}),r.$emit("update",r.products),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[3,12]])})),function(){var t=this,r=arguments;return new Promise((function(i,n){var o=e.apply(t,r);function s(t){d(o,i,n,s,a,"next",t)}function a(t){d(o,i,n,s,a,"throw",t)}s(void 0)}))})()},searchProducts:function(t){var e=this;n.ih.post("/api/nexopos/v4/products/search",{search:t,arguments:{type:{comparison:"<>",value:"grouped"}}}).subscribe({next:function(t){e.results=t},error:function(t){n.kX.error(t.message||(0,s.__)("An unexpected error occurred"),(0,s.__)("Ok"),{duration:3e3}).subscribe()}})}}};var f=r(1900);function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function v(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function _(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?v(Object(r),!0).forEach((function(e){h(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function h(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==m(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!==m(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===m(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const b={components:{nsProductGroup:(0,f.Z)(p,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"flex flex-col px-4 w-full"},[e("div",{staticClass:"md:-mx-4 flex flex-col md:flex-row"},[e("div",{staticClass:"md:px-4 w-full"},[e("div",{staticClass:"input-group border rounded info flex w-full"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchValue,expression:"searchValue"}],staticClass:"flex-auto p-2 outline-none",attrs:{placeholder:t.__("Search products..."),type:"text"},domProps:{value:t.searchValue},on:{input:function(e){e.target.composing||(t.searchValue=e.target.value)}}}),t._v(" "),e("button",{staticClass:"px-2",on:{click:function(e){return t.setSalePrice()}}},[t._v(t._s(t.__("Set Sale Price")))])]),t._v(" "),t.results.length>0&&t.searchValue.length>0?e("div",{staticClass:"h-0 relative"},[e("ul",{staticClass:"ns-vertical-menu absolute w-full"},t._l(t.results,(function(r){return e("li",{key:r.id,staticClass:"p-2 border-b cursor-pointer",on:{click:function(e){return t.addResult(r)}}},[t._v(t._s(r.name))])})),0)]):t._e(),t._v(" "),e("div",{staticClass:"my-2"},[e("table",{staticClass:"ns-table"},[e("thead",[e("tr",[e("th",{staticClass:"border",attrs:{colspan:"2"}},[t._v(t._s(t.__("Products")))])])]),t._v(" "),e("tbody",[t._l(t.products,(function(r,i){return e("tr",{key:i},[e("td",{staticClass:"border p-2",attrs:{colspan:"2"}},[e("div",{staticClass:"flex justify-between"},[e("h3",{staticClass:"font-bold"},[t._v(t._s(r.name))]),t._v(" "),e("span",{staticClass:"hover:underline text-error-secondary cursor-pointer",on:{click:function(e){return t.removeProduct(i)}}},[t._v(t._s(t.__("Remove")))])]),t._v(" "),e("ul",[e("li",{staticClass:"flex justify-between p-1 hover:bg-box-elevation-hover",on:{click:function(e){return t.toggleUnitField(r)}}},[e("span",[t._v(t._s(t.__("Unit"))+":")]),t._v(" "),e("select",{directives:[{name:"model",rawName:"v-model",value:r.unit_quantity_id,expression:"product.unit_quantity_id"}],ref:"unitField",refInFor:!0,attrs:{type:"text"},on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(r,"unit_quantity_id",e.target.multiple?i:i[0])},function(e){return t.redefineUnit(r)}]}},t._l(r.unit_quantities,(function(r){return e("option",{key:r.id,domProps:{value:r.id}},[t._v(t._s(r.unit.name))])})),0)]),t._v(" "),e("li",{staticClass:"flex justify-between p-1 hover:bg-box-elevation-hover",on:{click:function(e){return t.toggleQuantityField(r)}}},[e("span",[t._v(t._s(t.__("Quantity"))+":")]),t._v(" "),r._quantity_toggled?t._e():e("span",{staticClass:"cursor-pointer border-b border-dashed border-info-secondary"},[t._v(t._s(r.quantity))]),t._v(" "),r._quantity_toggled?e("input",{directives:[{name:"model",rawName:"v-model",value:r.quantity,expression:"product.quantity"}],ref:"quantityField",refInFor:!0,attrs:{type:"text"},domProps:{value:r.quantity},on:{input:function(e){e.target.composing||t.$set(r,"quantity",e.target.value)}}}):t._e()]),t._v(" "),e("li",{staticClass:"flex justify-between p-1 hover:bg-box-elevation-hover",on:{click:function(e){return t.togglePriceField(r)}}},[e("span",[t._v(t._s(t.__("Price"))+":")]),t._v(" "),r._price_toggled?t._e():e("span",{staticClass:"cursor-pointer border-b border-dashed border-info-secondary"},[t._v(t._s(t._f("currency")(r.sale_price)))]),t._v(" "),r._price_toggled?e("input",{directives:[{name:"model",rawName:"v-model",value:r.sale_price,expression:"product.sale_price"}],ref:"priceField",refInFor:!0,attrs:{type:"text"},domProps:{value:r.sale_price},on:{input:function(e){e.target.composing||t.$set(r,"sale_price",e.target.value)}}}):t._e()])])])])})),t._v(" "),0===t.products.length?e("tr",[e("td",{staticClass:"border p-2 text-center",attrs:{colspan:"2"}},[t._v("\n                                "+t._s(t.__("No product are added to this group."))+"\n                            ")])]):t._e()],2),t._v(" "),t.products.length>0?e("tfoot",[e("tr",[e("td",{staticClass:"w-1/2 border p-2 text-left"},[t._v(t._s(t.__("Total")))]),t._v(" "),e("td",{staticClass:"w-1/2 border p-2 text-right"},[t._v(t._s(t._f("currency")(t.totalProducts)))])])]):t._e()])])])])])}),[],!1,null,null,null).exports},data:function(){return{formValidation:new i.Z,nsSnackBar:n.kX,nsHttpClient:n.ih,_sampleVariation:null,unitLoaded:!1,form:""}},watch:{form:{deep:!0,handler:function(t){var e=this;this.form.variations.forEach((function(t){if("grouped"===e.formValidation.extractFields(t.tabs.identification.fields).type){for(var r in t.tabs)["identification","groups","taxes","units"].includes(r)||e.$set(t.tabs[r],"visible",!1);t.tabs.groups&&e.$set(t.tabs.groups,"visible",!0)}else{for(var i in t.tabs)["identification","groups","taxes","units"].includes(i)||e.$set(t.tabs[i],"visible",!0);t.tabs.groups&&e.$set(t.tabs.groups,"visible",!1)}}))}}},computed:{defaultVariation:function(){var t=new Object;for(var e in this._sampleVariation.tabs)t[e]=new Object,t[e].label=this._sampleVariation.tabs[e].label,t[e].active=this._sampleVariation.tabs[e].active,t[e].fields=this._sampleVariation.tabs[e].fields.filter((function(t){return!["category_id","product_type","stock_management","expires"].includes(t.name)})).map((function(t){return("string"==typeof t.value&&0===t.value.length||null===t.value)&&(t.value=""),t}));return{id:"",tabs:t}}},props:["submit-method","submit-url","return-url","src","units-url"],methods:{__:s.__,getGroupProducts:function(t){if(t.groups){var e=t.groups.fields.filter((function(t){return"products_subitems"===t.name}));if(console.log(e),e.length>0)return e[0].value}return[]},setProducts:function(t,e){e.groups.fields.forEach((function(e){"product_subitems"===e.name&&(e.value=t)}))},triggerRecompute:function(t){console.log(this.form)},getUnitQuantity:function(t){var e=t.filter((function(t){return"quantity"===t.name})).map((function(t){return t.value}));return e.length>0?e[0]:0},removeUnitPriceGroup:function(t,e){var r=this,i=t.filter((function(t){return"id"===t.name&&void 0!==t.value}));Popup.show(o.default,{title:(0,s.__)("Confirm Your Action"),message:(0,s.__)("Would you like to delete this group ?"),onAction:function(n){if(n)if(i.length>0)r.confirmUnitQuantityDeletion({group_fields:t,group:e});else{var o=e.indexOf(t);e.splice(o,1)}}})},confirmUnitQuantityDeletion:function(t){var e=t.group_fields,r=t.group;Popup.show(o.default,{title:(0,s.__)("Your Attention Is Required"),size:"w-3/4-screen h-2/5-screen",message:(0,s.__)("The current unit you're about to delete has a reference on the database and it might have already procured stock. Deleting that reference will remove procured stock. Would you proceed ?"),onAction:function(t){if(t){var i=e.filter((function(t){return"id"===t.name})).map((function(t){return t.value}))[0];n.ih.delete("/api/nexopos/v4/products/units/quantity/".concat(i)).subscribe((function(t){var i=r.indexOf(e);r.splice(i,1),n.kX.success(t.message).subscribe()}),(function(t){nsSnackbar.error(t.message).subscribe()}))}}})},addUnitGroup:function(t){if(0===t.options.length)return n.kX.error((0,s.__)("Please select at least one unit group before you proceed.")).subscribe();t.options.length>t.groups.length?t.groups.push(JSON.parse(JSON.stringify(t.fields))):n.kX.error((0,s.__)("There shoulnd't be more option than there are units.")).subscribe()},loadAvailableUnits:function(t){var e=this;this.unitLoaded=!1,n.ih.get(this.unitsUrl.replace("{id}",t.fields.filter((function(t){return"unit_group"===t.name}))[0].value)).subscribe((function(r){t.fields.forEach((function(t){"group"===t.type&&(t.options=r,t.fields.forEach((function(t){"unit_id"===t.name&&(console.log(t),t.options=r.map((function(t){return{label:t.name,value:t.id}})))})))})),e.unitLoaded=!0,e.$forceUpdate()}))},loadOptionsFor:function(t,e,r){var i=this;n.ih.get(this.unitsUrl.replace("{id}",e)).subscribe((function(e){i.form.variations[r].tabs.units.fields.forEach((function(r){r.name===t&&(r.options=e.map((function(t){return{label:t.name,value:t.id,selected:!1}})))})),i.$forceUpdate()}))},submit:function(){var t=this;if(this.formValidation.validateFields([this.form.main]),this.form.variations.map((function(e){return t.formValidation.validateForm(e)})).filter((function(t){return t.length>0})).length>0||Object.values(this.form.main.errors).length>0)return n.kX.error(this.$slots["error-form-invalid"]?this.$slots["error-form-invalid"][0].text:(0,s.__)("Unable to proceed the form is not valid.")).subscribe();var e=this.form.variations.map((function(t,e){return t.tabs.images.groups.filter((function(t){return t.filter((function(t){return"featured"===t.name&&1===t.value})).length>0}))}));if(e[0]&&e[0].length>1)return n.kX.error(this.$slots["error-multiple-primary"]?this.$slots["error-multiple-primary"][0].text:(0,s.__)("Unable to proceed, more than one product is set as featured")).subscribe();var r=[];if(this.form.variations.map((function(e,i){return e.tabs.units.fields.filter((function(t){return"group"===t.type})).forEach((function(e){new Object;e.groups.forEach((function(e){r.push(t.formValidation.validateFields(e))}))}))})),0===r.length)return n.kX.error(this.$slots["error-no-units-groups"]?this.$slots["error-no-units-groups"][0].text:(0,s.__)("Either Selling or Purchase unit isn't defined. Unable to proceed.")).subscribe();if(r.filter((function(t){return!1===t})).length>0)return this.$forceUpdate(),n.kX.error(this.$slots["error-invalid-unit-group"]?this.$slots["error-invalid-unit-group"][0].text:(0,s.__)("Unable to proceed as one of the unit group field is invalid")).subscribe();var i=_(_({},this.formValidation.extractForm(this.form)),{},{variations:this.form.variations.map((function(e,r){var i=t.formValidation.extractForm(e);0===r&&(i.$primary=!0),i.images=e.tabs.images.groups.map((function(e){return t.formValidation.extractFields(e)}));var n=new Object;return e.tabs.units.fields.filter((function(t){return"group"===t.type})).forEach((function(e){n[e.name]=e.groups.map((function(e){return t.formValidation.extractFields(e)}))})),i.units=_(_({},i.units),n),i}))});this.formValidation.disableForm(this.form),n.ih[this.submitMethod?this.submitMethod.toLowerCase():"post"](this.submitUrl,i).subscribe((function(e){if("success"===e.status){if("POST"===t.submitMethod&&!1!==t.returnUrl)return document.location=e.data.editUrl||t.returnUrl;n.kX.info(e.message,(0,s.__)("Okay"),{duration:3e3}).subscribe(),t.$emit("save")}t.formValidation.enableForm(t.form)}),(function(e){n.kX.error(e.message,void 0,{duration:5e3}).subscribe(),t.formValidation.enableForm(t.form),e.response&&t.formValidation.triggerError(t.form,e.response.data)}))},deleteVariation:function(t){confirm(this.$slots["delete-variation"]?this.$slots["delete-variation"][0].text:(0,s.__)("Would you like to delete this variation ?"))&&this.form.variations.splice(t,1)},setTabActive:function(t,e){for(var r in e)r!==t&&(e[r].active=!1);e[t].active=!0,"units"===t&&this.loadAvailableUnits(e[t])},duplicate:function(t){this.form.variations.push(Object.assign({},t))},newVariation:function(){this.form.variations.push(this.defaultVariation)},getActiveTab:function(t){for(var e in t)if(t[e].active)return t[e];return!1},getActiveTabKey:function(t){for(var e in t)if(t[e].active)return e;return!1},parseForm:function(t){var e=this;return t.main.value=void 0===t.main.value?"":t.main.value,t.main=this.formValidation.createFields([t.main])[0],t.variations.forEach((function(t,r){var i=0;for(var n in t.tabs)0===i&&void 0===t.tabs[n].active?(t.tabs[n].active=!0,e._sampleVariation=JSON.parse(JSON.stringify(t)),t.tabs[n].fields&&(t.tabs[n].fields=e.formValidation.createFields(t.tabs[n].fields.filter((function(t){return"name"!==t.name}))))):t.tabs[n].fields&&(t.tabs[n].fields=e.formValidation.createFields(t.tabs[n].fields)),t.tabs[n].active=void 0!==t.tabs[n].active&&t.tabs[n].active,t.tabs[n].visible=void 0===t.tabs[n].visible||t.tabs[n].visible,i++})),t},loadForm:function(){var t=this;n.ih.get("".concat(this.src)).subscribe((function(e){t.form=t.parseForm(e.form)}))},addImage:function(t){t.tabs.images.groups.push(this.formValidation.createFields(JSON.parse(JSON.stringify(t.tabs.images.fields))))},removeImage:function(t,e){var r=t.tabs.images.groups.indexOf(e);t.tabs.images.groups.splice(r,1)}},mounted:function(){this.loadForm()},name:"ns-manage-products"};const g=(0,f.Z)(b,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"form flex-auto",attrs:{id:"crud-form"}},[0===Object.values(t.form).length?e("div",{staticClass:"flex items-center h-full justify-center flex-auto"},[e("ns-spinner")],1):t._e(),t._v(" "),Object.values(t.form).length>0?[e("div",{staticClass:"flex flex-col"},[e("div",{staticClass:"flex justify-between items-center"},[e("label",{staticClass:"font-bold my-2 text-primary",attrs:{for:"title"}},[t._v(t._s(t.form.main.label))]),t._v(" "),e("div",{staticClass:"text-sm my-2 text-primary",attrs:{for:"title"}},[t.returnUrl?e("a",{staticClass:"rounded-full border ns-inset-button error hover:bg-error-tertiary px-2 py-1",attrs:{href:t.returnUrl}},[t._v(t._s(t.__("Return")))]):t._e()])]),t._v(" "),e("div",{staticClass:"input-group info flex border rounded overflow-hidden",class:t.form.main.disabled?"":t.form.main.errors.length>0?"border-error-tertiary":""},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.main.value,expression:"form.main.value"}],staticClass:"flex-auto text-primary outline-none h-10 px-2",class:(t.form.main.disabled,""),attrs:{disabled:t.form.main.disabled,type:"text"},domProps:{value:t.form.main.value},on:{blur:function(e){return t.formValidation.checkField(t.form.main)},change:function(e){return t.formValidation.checkField(t.form.main)},input:function(e){e.target.composing||t.$set(t.form.main,"value",e.target.value)}}}),t._v(" "),e("button",{staticClass:"outline-none px-4 h-10 rounded-none",class:t.form.main.disabled?"":t.form.main.errors.length>0?"bg-error-tertiary":"",attrs:{disabled:t.form.main.disabled},on:{click:function(e){return t.submit()}}},[t._t("save",(function(){return[t._v(t._s(t.__("Save")))]}))],2)]),t._v(" "),t.form.main.description&&0===t.form.main.errors.length?e("p",{staticClass:"text-xs text-primary py-1"},[t._v(t._s(t.form.main.description))]):t._e(),t._v(" "),t._l(t.form.main.errors,(function(r,i){return e("p",{key:i,staticClass:"text-xs py-1 text-error-tertiary"},[e("span",[t._t("error-required",(function(){return[t._v(t._s(r.identifier))]}))],2)])}))],2),t._v(" "),e("div",{staticClass:"-mx-4 flex flex-wrap mt-4",attrs:{id:"form-container"}},[e("div",{staticClass:"px-4 w-full"},t._l(t.form.variations,(function(r,i){return e("div",{key:i,staticClass:"mb-8",attrs:{id:"tabbed-card"}},[e("div",{staticClass:"flex flex-wrap justify-between ns-tab",attrs:{id:"card-header"}},[e("div",{staticClass:"flex flex-wrap"},[t._l(r.tabs,(function(i,n){return[i.visible?e("div",{key:n,staticClass:"tab cursor-pointer text-primary px-4 py-2 rounded-tl-lg rounded-tr-lg flex justify-between",class:i.active?"active":"inactive",on:{click:function(e){return t.setTabActive(n,r.tabs)}}},[e("span",{staticClass:"block mr-2"},[t._v(t._s(i.label))]),t._v(" "),i.errors&&i.errors.length>0?e("span",{staticClass:"rounded-full bg-error-secondary text-white h-6 w-6 flex font-semibold items-center justify-center"},[t._v(t._s(i.errors.length))]):t._e()]):t._e()]}))],2),t._v(" "),e("div",{staticClass:"flex items-center justify-center -mx-1"})]),t._v(" "),e("div",{staticClass:"card-body ns-tab-item rounded-br-lg rounded-bl-lg shadow p-2"},[["images","units","groups"].includes(t.getActiveTabKey(r.tabs))?t._e():e("div",{staticClass:"-mx-4 flex flex-wrap"},[t._l(t.getActiveTab(r.tabs).fields,(function(t,r){return[e("div",{key:r,staticClass:"flex flex-col px-4 w-full md:w-1/2 lg:w-1/3"},[e("ns-field",{attrs:{field:t}})],1)]}))],2),t._v(" "),"images"===t.getActiveTabKey(r.tabs)?e("div",{staticClass:"-mx-4 flex flex-wrap text-primary"},[e("div",{staticClass:"flex flex-col px-4 w-full md:w-1/2 lg:w-1/3"},[e("div",{staticClass:"rounded border border-box-elevation-edge bg-box-elevation-background flex justify-between p-2 items-center"},[e("span",[t._v(t._s(t.__("Add Images")))]),t._v(" "),e("button",{staticClass:"outline-none rounded-full border flex items-center justify-center w-8 h-8 ns-inset-button info",on:{click:function(e){return t.addImage(r)}}},[e("i",{staticClass:"las la-plus-circle"})])])]),t._v(" "),t._l(t.getActiveTab(r.tabs).groups,(function(i,n){return e("div",{key:n,staticClass:"flex flex-col px-4 w-full md:w-1/2 lg:w-1/3 mb-4"},[e("div",{staticClass:"rounded border border-box-elevation-edge flex flex-col overflow-hidden"},[e("div",{staticClass:"p-2"},t._l(i,(function(t,r){return e("ns-field",{key:r,attrs:{field:t}})})),1),t._v(" "),e("div",{staticClass:"text-center py-2 border-t border-box-elevation-edge text-sm cursor-pointer",on:{click:function(e){return t.removeImage(r,i)}}},[t._v("\n                                        "+t._s(t.__("Remove Image"))+"\n                                    ")])])])}))],2):t._e(),t._v(" "),"groups"===t.getActiveTabKey(r.tabs)?e("div",{staticClass:"-mx-4 flex flex-wrap text-primary"},[e("ns-product-group",{attrs:{fields:t.getActiveTab(r.tabs).fields},on:{update:function(e){return t.setProducts(e,r.tabs)},updateSalePrice:function(e){return t.triggerRecompute(e,r.tabs)}}})],1):t._e(),t._v(" "),"units"===t.getActiveTabKey(r.tabs)?e("div",{staticClass:"-mx-4 flex flex-wrap"},[e("div",{staticClass:"px-4 w-full md:w-1/2 lg:w-1/3"},[e("ns-field",{attrs:{field:t.getActiveTab(r.tabs).fields[0]},on:{change:function(e){t.loadAvailableUnits(t.getActiveTab(r.tabs))}}}),t._v(" "),e("ns-field",{attrs:{field:t.getActiveTab(r.tabs).fields[1]},on:{change:function(e){t.loadAvailableUnits(t.getActiveTab(r.tabs))}}})],1),t._v(" "),t.unitLoaded?[t._l(t.getActiveTab(r.tabs).fields,(function(r,i){return["group"===r.type?e("div",{key:i,staticClass:"px-4 w-full lg:w-2/3"},[e("div",{staticClass:"mb-2"},[e("label",{staticClass:"font-medium text-primary"},[t._v(t._s(r.label))]),t._v(" "),e("p",{staticClass:"py-1 text-sm text-primary"},[t._v(t._s(r.description))])]),t._v(" "),e("div",{staticClass:"mb-2"},[e("div",{staticClass:"border-dashed border p-1 bg-box-elevation-background border-box-elevation-edge flex justify-between items-center text-primary cursor-pointer rounded-lg",on:{click:function(e){return t.addUnitGroup(r)}}},[t._m(0,!0),t._v(" "),e("span",[t._v(t._s(t.__("New Group")))])])]),t._v(" "),e("div",{staticClass:"-mx-4 flex flex-wrap"},t._l(r.groups,(function(i,n){return e("div",{key:n,staticClass:"px-4 w-full md:w-1/2 mb-4"},[e("div",{staticClass:"shadow rounded overflow-hidden bg-box-elevation-background text-primary"},[e("div",{staticClass:"border-b text-sm p-2 flex justify-between text-primary border-box-elevation-edge"},[e("span",[t._v(t._s(t.__("Available Quantity")))]),t._v(" "),e("span",[t._v(t._s(t.getUnitQuantity(i)))])]),t._v(" "),e("div",{staticClass:"p-2 mb-2"},t._l(i,(function(t,r){return e("ns-field",{key:r,attrs:{field:t}})})),1),t._v(" "),e("div",{staticClass:"p-1 hover:bg-error-primary border-t border-box-elevation-edge flex items-center justify-center cursor-pointer font-medium",on:{click:function(e){return t.removeUnitPriceGroup(i,r.groups)}}},[t._v("\n                                                        "+t._s(t.__("Delete"))+"\n                                                    ")])])])})),0)]):t._e()]}))]:t._e(),t._v(" "),t.unitLoaded?t._e():[e("div",{staticClass:"px-4 w-full lg:w-2/3 flex justify-center items-center"},[e("ns-spinner")],1)]],2):t._e()])])})),0)])]:t._e()],2)}),[function(){var t=this._self._c;return t("span",{staticClass:"rounded-full border ns-inset-button info h-8 w-8 flex items-center justify-center"},[t("i",{staticClass:"las la-plus-circle"})])}],!1,null,null,null).exports},1571:(t,e,r)=>{r.r(e),r.d(e,{default:()=>h});var i=r(3658),n=r(2277),o=r(1487),s=r(2792),a=r(6891),u=r(8094);const c={name:"ns-procurement-product-options",data:function(){return{validation:new i.Z,fields:[],rawFields:[{label:(0,u.__)("Expiration Date"),name:"expiration_date",description:(0,u.__)("Define when that specific product should expire."),type:"datetimepicker"},{label:(0,u.__)("Barcode"),name:"barcode",description:(0,u.__)("Renders the automatically generated barcode."),type:"text",disabled:!0},{label:(0,u.__)("Tax Type"),name:"tax_type",description:(0,u.__)("Adjust how tax is calculated on the item."),type:"select",options:[{label:(0,u.__)("Inclusive"),value:"inclusive"},{label:(0,u.__)("Exclusive"),value:"exclusive"}]}]}},methods:{__:u.__,applyChanges:function(){if(this.validation.validateFields(this.fields)){var t=this.validation.extractFields(this.fields);return this.$popupParams.resolve(t),this.$popup.close()}return o.kX.error((0,u.__)("Unable to proceed. The form is not valid.")).subscribe()}},mounted:function(){var t=this;this.$popup.event.subscribe((function(e){"click-overlay"===e.event&&t.$popup.close()}));var e=this.rawFields.map((function(e){return"expiration_date"===e.name&&(e.value=t.$popupParams.product.procurement.expiration_date),"tax_type"===e.name&&(e.value=t.$popupParams.product.procurement.tax_type),"barcode"===e.name&&(e.value=t.$popupParams.product.procurement.barcode),e}));this.fields=this.validation.createFields(e)}};var l=r(1900);const d=(0,l.Z)(c,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"ns-box shadow-lg w-6/7-screen md:w-5/7-screen lg:w-3/7-screen"},[e("div",{staticClass:"p-2 border-b ns-box-header"},[e("h5",{staticClass:"font-semibold"},[t._v(t._s(t.__("Options")))])]),t._v(" "),e("div",{staticClass:"p-2 border-b ns-box-body"},t._l(t.fields,(function(t,r){return e("ns-field",{key:r,staticClass:"w-full",attrs:{field:t}})})),1),t._v(" "),e("div",{staticClass:"p-2 flex justify-end ns-box-body"},[e("ns-button",{attrs:{type:"info"},on:{click:function(e){return t.applyChanges()}}},[t._v(t._s(t.__("Save")))])],1)])}),[],!1,null,null,null).exports;function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function f(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function m(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?f(Object(r),!0).forEach((function(e){v(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function v(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==p(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!==p(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===p(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const _={name:"ns-procurement",mounted:function(){this.reloadEntities()},computed:{activeTab:function(){return this.validTabs.filter((function(t){return t.active})).length>0&&this.validTabs.filter((function(t){return t.active}))[0]}},data:function(){return{totalTaxValues:0,totalPurchasePrice:0,formValidation:new i.Z,form:{},nsSnackBar:o.kX,fields:[],searchResult:[],searchValue:"",debounceSearch:null,nsHttpClient:o.ih,taxes:[],validTabs:[{label:(0,u.__)("Details"),identifier:"details",active:!0},{label:(0,u.__)("Products"),identifier:"products",active:!1}],reloading:!1}},watch:{searchValue:function(t){var e=this;t&&(clearTimeout(this.debounceSearch),this.debounceSearch=setTimeout((function(){e.doSearch(t)}),500))}},components:{nsManageProducts:s.default},props:["submit-method","submit-url","return-url","src","rules"],methods:{__:u.__,computeTotal:function(){this.totalTaxValues=0,this.form.products.length>0&&(this.totalTaxValues=this.form.products.map((function(t){return t.procurement.tax_value})).reduce((function(t,e){return t+e}))),this.totalPurchasePrice=0,this.form.products.length>0&&(this.totalPurchasePrice=this.form.products.map((function(t){return parseFloat(t.procurement.total_purchase_price)})).reduce((function(t,e){return t+e})))},updateLine:function(t){var e=this.form.products[t],r=this.taxes.filter((function(t){return t.id===e.procurement.tax_group_id}));if(parseFloat(e.procurement.purchase_price_edit)>0&&parseFloat(e.procurement.quantity)>0){if(r.length>0){var i=r[0].taxes.map((function(t){return a.Z.getTaxValue(e.procurement.tax_type,e.procurement.purchase_price_edit,parseFloat(t.rate))}));e.procurement.tax_value=i.reduce((function(t,e){return t+e})),"inclusive"===e.procurement.tax_type?(e.procurement.net_purchase_price=parseFloat(e.procurement.purchase_price_edit)-e.procurement.tax_value,e.procurement.gross_purchase_price=parseFloat(e.procurement.purchase_price_edit),e.procurement.purchase_price=parseFloat(e.procurement.gross_purchase_price)):(e.procurement.gross_purchase_price=parseFloat(e.procurement.purchase_price_edit)+e.procurement.tax_value,e.procurement.net_purchase_price=parseFloat(e.procurement.purchase_price_edit),e.procurement.purchase_price=parseFloat(e.procurement.gross_purchase_price))}else e.procurement.gross_purchase_price=parseFloat(e.procurement.purchase_price_edit),e.procurement.purchase_price=parseFloat(e.procurement.purchase_price_edit),e.procurement.net_purchase_price=parseFloat(e.procurement.purchase_price_edit),e.procurement.tax_value=0;e.procurement.tax_value=e.procurement.tax_value*parseFloat(e.procurement.quantity),e.procurement.total_purchase_price=e.procurement.purchase_price*parseFloat(e.procurement.quantity)}this.computeTotal(),this.$forceUpdate()},fetchLastPurchasePrice:function(t){var e=this.form.products[t],r=e.unit_quantities.filter((function(t){return e.procurement.unit_id===t.unit_id}));r.length>0&&(e.procurement.purchase_price_edit=r[0].last_purchase_price||0),this.updateLine(t)},switchTaxType:function(t,e){t.procurement.tax_type="inclusive"===t.procurement.tax_type?"exclusive":"inclusive",this.updateLine(e)},doSearch:function(t){var e=this;o.ih.post("/api/nexopos/v4/procurements/products/search-product",{search:t}).subscribe((function(t){1===t.length?e.addProductList(t[0]):t.length>1?e.searchResult=t:o.kX.error((0,u.__)("No result match your query.")).subscribe()}))},reloadEntities:function(){var t=this;this.reloading=!0,(0,n.D)([o.ih.get("/api/nexopos/v4/categories"),o.ih.get("/api/nexopos/v4/products"),o.ih.get(this.src),o.ih.get("/api/nexopos/v4/taxes/groups")]).subscribe((function(e){t.reloading=!1,t.categories=e[0],t.products=e[1],t.taxes=e[3],t.form.general&&e[2].tabs.general.fieds.forEach((function(e,r){e.value=t.form.tabs.general.fields[r].value||""})),t.form=Object.assign(JSON.parse(JSON.stringify(e[2])),t.form),t.form=t.formValidation.createForm(t.form),t.form.tabs&&t.form.tabs.general.fields.forEach((function(t,r){t.options&&(t.options=e[2].tabs.general.fields[r].options)})),0===t.form.products.length&&(t.form.products=t.form.products.map((function(t){return["gross_purchase_price","purchase_price_edit","tax_value","net_purchase_price","purchase_price","total_price","total_purchase_price","quantity","tax_group_id"].forEach((function(e){void 0===t[e]&&(t[e]=void 0===t[e]?0:t[e])})),t.$invalid=t.$invalid||!1,t.purchase_price_edit=t.purchase_price,{name:t.name,purchase_units:t.purchase_units,procurement:t,unit_quantities:t.unit_quantities||[]}}))),t.$forceUpdate()}))},setTabActive:function(t){this.validTabs.forEach((function(t){return t.active=!1})),this.$forceUpdate(),this.$nextTick().then((function(){t.active=!0}))},addProductList:function(t){if(void 0===t.unit_quantities)return o.kX.error((0,u.__)("Unable to add product which doesn't unit quantities defined.")).subscribe();t.procurement=new Object,t.procurement.gross_purchase_price=0,t.procurement.purchase_price_edit=0,t.procurement.tax_value=0,t.procurement.net_purchase_price=0,t.procurement.purchase_price=0,t.procurement.total_price=0,t.procurement.total_purchase_price=0,t.procurement.quantity=1,t.procurement.expiration_date=null,t.procurement.tax_group_id=0,t.procurement.tax_type="inclusive",t.procurement.unit_id=0,t.procurement.product_id=t.id,t.procurement.procurement_id=null,t.procurement.$invalid=!1,this.searchResult=[],this.searchValue="",this.form.products.push(t)},submit:function(){var t=this;if(0===this.form.products.length)return o.kX.error(this.$slots["error-no-products"]?this.$slots["error-no-products"][0].text:(0,u.__)("Unable to proceed, no product were provided."),this.$slots.okay?this.$slots.okay[0].text:(0,u.__)("OK")).subscribe();if(this.form.products.forEach((function(t){!parseFloat(t.procurement.quantity)>=1||0===t.procurement.unit_id?t.procurement.$invalid=!0:t.procurement.$invalid=!1})),this.form.products.filter((function(t){return t.procurement.$invalid})).length>0)return o.kX.error(this.$slots["error-invalid-products"]?this.$slots["error-invalid-products"][0].text:(0,u.__)("Unable to proceed, one or more product has incorrect values."),this.$slots.okay?this.$slots.okay[0].text:(0,u.__)("OK")).subscribe();if(this.formValidation.validateForm(this.form).length>0)return this.setTabActive(this.activeTab),o.kX.error(this.$slots["error-invalid-form"]?this.$slots["error-invalid-form"][0].text:(0,u.__)("Unable to proceed, the procurement form is not valid."),this.$slots.okay?this.$slots.okay[0].text:(0,u.__)("OK")).subscribe();if(void 0===this.submitUrl)return o.kX.error(this.$slots["error-no-submit-url"]?this.$slots["error-no-submit-url"][0].text:(0,u.__)("Unable to submit, no valid submit URL were provided."),this.$slots.okay?this.$slots.okay[0].text:(0,u.__)("OK")).subscribe();this.formValidation.disableForm(this.form);var e=m(m({},this.formValidation.extractForm(this.form)),{products:this.form.products.map((function(t){return t.procurement}))});o.ih[this.submitMethod?this.submitMethod.toLowerCase():"post"](this.submitUrl,e).subscribe((function(e){if("success"===e.status)return document.location=t.returnUrl;t.formValidation.enableForm(t.form)}),(function(e){o.kX.error(e.message,void 0,{duration:5e3}).subscribe(),t.formValidation.enableForm(t.form),e.errors&&t.formValidation.triggerError(t.form,e.errors)}))},deleteProduct:function(t){this.form.products.splice(t,1),this.$forceUpdate()},handleGlobalChange:function(t){this.globallyChecked=t,this.rows.forEach((function(e){return e.$checked=t}))},setProductOptions:function(t){var e=this;new Promise((function(r,i){Popup.show(d,{product:e.form.products[t],resolve:r,reject:i})})).then((function(r){for(var i in r)e.form.products[t].procurement[i]=r[i];e.updateLine(t)}))}}};const h=(0,l.Z)(_,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"form flex-auto flex flex-col",attrs:{id:"crud-form"}},[t.form.main?[e("div",{staticClass:"flex flex-col"},[e("div",{staticClass:"flex justify-between items-center"},[e("label",{staticClass:"font-bold my-2 text-primary",attrs:{for:"title"}},[t._v(t._s(t.form.main.label||t.__("No title is provided")))]),t._v(" "),e("div",{staticClass:"text-sm my-2 text-primary",attrs:{for:"title"}},[t.returnUrl?e("a",{staticClass:"rounded-full ns-inset-button border px-2 py-1",attrs:{href:t.returnUrl}},[t._v(t._s(t.__("Go Back")))]):t._e()])]),t._v(" "),e("div",{staticClass:"flex border rounded input-group info overflow-hidden",class:t.form.main.disabled?"disabled":t.form.main.errors.length>0?"error":""},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.main.value,expression:"form.main.value"}],staticClass:"flex-auto outline-none h-10 px-2",class:(t.form.main.disabled,""),attrs:{disabled:t.form.main.disabled,type:"text"},domProps:{value:t.form.main.value},on:{blur:function(e){return t.formValidation.checkField(t.form.main)},change:function(e){return t.formValidation.checkField(t.form.main)},input:function(e){e.target.composing||t.$set(t.form.main,"value",e.target.value)}}}),t._v(" "),e("button",{staticClass:"outline-none px-4 h-10 border-l",attrs:{disabled:t.form.main.disabled},on:{click:function(e){return t.submit()}}},[t._t("save",(function(){return[t._v(t._s(t.__("Save")))]}))],2),t._v(" "),e("button",{staticClass:"outline-none px-4 h-10",on:{click:function(e){return t.reloadEntities()}}},[e("i",{staticClass:"las la-sync",class:t.reloading?"animate animate-spin":""})])]),t._v(" "),t.form.main.description&&0===t.form.main.errors.length?e("p",{staticClass:"text-xs text-primary py-1"},[t._v(t._s(t.form.main.description))]):t._e(),t._v(" "),t._l(t.form.main.errors,(function(r,i){return e("p",{key:i,staticClass:"text-xs py-1 text-error-primary"},[e("span",[t._t("error-required",(function(){return[t._v(t._s(r.identifier))]}))],2)])}))],2),t._v(" "),e("div",{staticClass:"-mx-4 flex flex-wrap mt-4",attrs:{id:"form-container"}},[e("div",{staticClass:"px-4 w-full"},[e("div",{staticClass:"ns-tab",attrs:{id:"tabbed-card"}},[e("div",{staticClass:"flex flex-wrap",attrs:{id:"card-header"}},t._l(t.validTabs,(function(r,i){return e("div",{key:i,staticClass:"tab cursor-pointer px-4 py-2 rounded-tl-lg rounded-tr-lg text-primary",class:r.active?"active":"inactive",on:{click:function(e){return t.setTabActive(r)}}},[t._v("\n                            "+t._s(r.label)+"\n                        ")])})),0),t._v(" "),"details"===t.activeTab.identifier?e("div",{staticClass:"card-body ns-tab-item rounded-br-lg rounded-bl-lg shadow p-2"},[t.form.tabs?e("div",{staticClass:"-mx-4 flex flex-wrap"},t._l(t.form.tabs.general.fields,(function(t,r){return e("div",{key:r,staticClass:"flex px-4 w-full md:w-1/2 lg:w-1/3"},[e("ns-field",{attrs:{field:t}})],1)})),0):t._e()]):t._e(),t._v(" "),"products"===t.activeTab.identifier?e("div",{staticClass:"card-body ns-tab-item rounded-br-lg rounded-bl-lg shadow p-2"},[e("div",{staticClass:"mb-2"},[e("div",{staticClass:"input-group info flex border rounded overflow-hidden"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchValue,expression:"searchValue"}],staticClass:"flex-auto text-primary outline-none h-10 px-2",attrs:{type:"text",placeholder:t.$slots["search-placeholder"]?t.$slots["search-placeholder"][0].text:"SKU, Barcode, Name"},domProps:{value:t.searchValue},on:{input:function(e){e.target.composing||(t.searchValue=e.target.value)}}})]),t._v(" "),e("div",{staticClass:"h-0"},[e("div",{staticClass:"shadow bg-floating-menu relative z-10"},t._l(t.searchResult,(function(r,i){return e("div",{key:i,staticClass:"cursor-pointer border border-b hover:bg-floating-menu-hover border-floating-menu-edge p-2 text-primary",on:{click:function(e){return t.addProductList(r)}}},[e("span",{staticClass:"block font-bold text-primary"},[t._v(t._s(r.name))]),t._v(" "),e("span",{staticClass:"block text-sm text-priamry"},[t._v(t._s(t.__("SKU"))+" : "+t._s(r.sku))]),t._v(" "),e("span",{staticClass:"block text-sm text-primary"},[t._v(t._s(t.__("Barcode"))+" : "+t._s(r.barcode))])])})),0)])]),t._v(" "),e("div",{staticClass:"overflow-x-auto"},[e("table",{staticClass:"w-full ns-table"},[e("thead",[e("tr",t._l(t.form.columns,(function(r,i){return e("td",{key:i,staticClass:"text-primary p-2 border",attrs:{width:"200"}},[t._v(t._s(r.label))])})),0)]),t._v(" "),e("tbody",[t._l(t.form.products,(function(r,i){return e("tr",{key:i,class:r.procurement.$invalid?"error border border-error-primary":""},[t._l(t.form.columns,(function(n,o){return["name"===n.type?e("td",{key:o,staticClass:"p-2 text-primary border"},[e("span",{staticClass:"font-semibold"},[t._v(t._s(r.name))]),t._v(" "),e("div",{staticClass:"flex justify-between"},[e("div",{staticClass:"flex -mx-1 flex-col"},[e("div",{staticClass:"px-1"},[e("span",{staticClass:"text-xs text-error-primary cursor-pointer underline px-1",on:{click:function(e){return t.deleteProduct(i)}}},[t._v(t._s(t.__("Delete")))])])]),t._v(" "),e("div",{staticClass:"flex -mx-1 flex-col"},[e("div",{staticClass:"px-1"},[e("span",{staticClass:"text-xs text-error-primary cursor-pointer underline px-1",on:{click:function(e){return t.setProductOptions(i)}}},[t._v(t._s(t.__("Options")))])])])])]):t._e(),t._v(" "),"text"===n.type?e("td",{key:o,staticClass:"p-2 w-3 text-primary border"},[e("div",{staticClass:"flex items-start"},[e("div",{staticClass:"input-group rounded border"},[e("input",{directives:[{name:"model",rawName:"v-model",value:r.procurement[o],expression:"product.procurement[ key ]"}],staticClass:"w-24 p-2",attrs:{type:"text"},domProps:{value:r.procurement[o]},on:{change:function(e){return t.updateLine(i)},input:function(e){e.target.composing||t.$set(r.procurement,o,e.target.value)}}})])])]):t._e(),t._v(" "),"tax_group_id"===n.type?e("td",{key:o,staticClass:"p-2 text-primary border"},[e("div",{staticClass:"flex items-start"},[e("div",{staticClass:"input-group rounded border"},[e("select",{directives:[{name:"model",rawName:"v-model",value:r.procurement.tax_group_id,expression:"product.procurement.tax_group_id"}],staticClass:"p-2",on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(r.procurement,"tax_group_id",e.target.multiple?i:i[0])},function(e){return t.updateLine(i)}]}},t._l(t.taxes,(function(r){return e("option",{key:r.id,domProps:{value:r.id}},[t._v(t._s(r.name))])})),0)])])]):t._e(),t._v(" "),"custom_select"===n.type?e("td",{key:o,staticClass:"p-2 text-primary border"},[e("div",{staticClass:"flex items-start"},[e("div",{staticClass:"input-group rounded border"},[e("select",{directives:[{name:"model",rawName:"v-model",value:r.procurement[o],expression:"product.procurement[ key ]"}],staticClass:"p-2",on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(r.procurement,o,e.target.multiple?i:i[0])},function(e){return t.updateLine(i)}]}},t._l(n.options,(function(r){return e("option",{key:r.value,domProps:{value:r.value}},[t._v(t._s(r.label))])})),0)])])]):t._e(),t._v(" "),"currency"===n.type?e("td",{key:o,staticClass:"p-2 text-primary border"},[e("div",{staticClass:"flex items-start flex-col justify-end"},[e("span",{staticClass:"text-sm text-primary"},[t._v(t._s(t._f("currency")(r.procurement[o])))])])]):t._e(),t._v(" "),"unit_quantities"===n.type?e("td",{key:o,staticClass:"p-2 text-primary border"},[e("div",{staticClass:"flex items-start"},[e("div",{staticClass:"input-group rounded border"},[e("select",{directives:[{name:"model",rawName:"v-model",value:r.procurement.unit_id,expression:"product.procurement.unit_id"}],staticClass:"p-2 w-32",on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(r.procurement,"unit_id",e.target.multiple?i:i[0])},function(e){return t.fetchLastPurchasePrice(i)}]}},t._l(r.unit_quantities,(function(r){return e("option",{key:r.id,domProps:{value:r.unit.id}},[t._v(t._s(r.unit.name))])})),0)])])]):t._e()]}))],2)})),t._v(" "),e("tr",{staticClass:"text-primary"},[e("td",{staticClass:"p-2 border",attrs:{colspan:Object.keys(t.form.columns).indexOf("tax_value")}}),t._v(" "),e("td",{staticClass:"p-2 border"},[t._v(t._s(t._f("currency")(t.totalTaxValues)))]),t._v(" "),e("td",{staticClass:"p-2 border",attrs:{colspan:Object.keys(t.form.columns).indexOf("total_purchase_price")-(Object.keys(t.form.columns).indexOf("tax_value")+1)}}),t._v(" "),e("td",{staticClass:"p-2 border"},[t._v(t._s(t._f("currency")(t.totalPurchasePrice)))])])],2)])])]):t._e()])])])]:t._e()],2)}),[],!1,null,null,null).exports},2909:(t,e,r)=>{r.d(e,{Z:()=>s});var i=r(2867),n=r(8094);const o={data:function(){return{value:[],options:[],description:"",label:null,type:"select"}},computed:{},mounted:function(){this.popupCloser(),this.value=this.$popupParams.value||[],this.options=this.$popupParams.options,this.label=this.$popupParams.label,this.description=this.$popupParams.description||"",this.type=this.$popupParams.type||this.type},methods:{popupCloser:i.Z,__:n.__,toggle:function(t){var e=this.value.indexOf(t);-1===e?this.value.unshift(t):this.value.splice(e,1)},isSelected:function(t){return this.value.indexOf(t)>=0},close:function(){this.$popupParams.reject(!1),this.$popup.close()},select:function(t){void 0!==t&&(this.value=[t]),this.$popupParams.resolve(this.value),this.close()}}};const s=(0,r(1900).Z)(o,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"shadow-xl ns-box w-6/7-screen md:w-4/7-screen lg:w-3/7-screen max-h-5/6-screen overflow-hidden flex flex-col"},[e("div",{staticClass:"p-2 flex justify-between border-b items-center ns-box-header"},[e("span",{staticClass:"text-semibold text-primary"},[t._v("\n            "+t._s(t.label)+"\n        ")]),t._v(" "),e("div",[e("ns-close-button",{on:{click:function(e){return t.close()}}})],1)]),t._v(" "),e("div",{staticClass:"flex flex-col overflow-hidden"},[t.description.length>0?e("p",{staticClass:"p-2 text-center text-sm bg-info-primary"},[t._v(t._s(t.description))]):t._e(),t._v(" "),e("div",{staticClass:"overflow-y-auto"},[e("ul",{staticClass:"ns-vertical-menu"},["select"===t.type?t._l(t.options,(function(r){return e("li",{key:r.value,staticClass:"p-2 border-b border-box-edge text-primary cursor-pointer",on:{click:function(e){return t.select(r)}}},[t._v(t._s(r.label))])})):t._e(),t._v(" "),"multiselect"===t.type?t._l(t.options,(function(r){return e("li",{key:r.value,staticClass:"p-2 border-b text-primary cursor-pointer",class:t.isSelected(r)?"active":"",on:{click:function(e){return t.toggle(r)}}},[t._v(t._s(r.label))])})):t._e()],2)])]),t._v(" "),"multiselect"===t.type?e("div",{staticClass:"flex justify-between"},[e("div"),t._v(" "),e("div",[e("ns-button",{attrs:{type:"info"},on:{click:function(e){return t.select()}}},[t._v(t._s(t.__("Select")))])],1)]):t._e()])}),[],!1,null,null,null).exports}}]);